Index: BUILD
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/BUILD b/BUILD
--- a/BUILD	(revision 3ab128cca552dc3dc9b3abd621456f7b4aebaf47)
+++ b/BUILD	(date 1744039024779)
@@ -1,3 +1,4 @@
+load("@bazel_skylib//lib:selects.bzl", "selects")
 load(
     "//bazel:build_defs.bzl",
     "UPB_DEFAULT_COPTS",
@@ -31,6 +32,33 @@
     constraint_values = ["@platforms//os:windows"],
 )

+config_setting(
+    name = "darwin_legacy",
+    values = {"cpu": "darwin"},
+    visibility = ["//visibility:public"],
+)
+
+config_setting(
+    name = "darwin_x86_64",
+    values = {"cpu": "darwin_x86_64"},
+    visibility = ["//visibility:public"],
+)
+
+config_setting(
+    name = "darwin_arm64",
+    values = {"cpu": "darwin_arm64"},
+    visibility = ["//visibility:public"],
+)
+
+selects.config_setting_group(
+    name = "darwin",
+    match_any = [
+        ":darwin_legacy",
+        ":darwin_x86_64",
+        ":darwin_arm64",
+    ],
+)
+
 upb_fasttable_enabled(
     name = "fasttable_enabled",
     build_setting_default = False,
Index: bazel/build_defs.bzl
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/bazel/build_defs.bzl b/bazel/build_defs.bzl
--- a/bazel/build_defs.bzl	(revision 3ab128cca552dc3dc9b3abd621456f7b4aebaf47)
+++ b/bazel/build_defs.bzl	(date 1744039158049)
@@ -16,6 +16,11 @@

 UPB_DEFAULT_COPTS = select({
     "//:windows": [],
+    "//:darwin": [
+        # remove first one after MacOS 15.3 is not supported
+        "-Wno-gnu-offsetof-extensions",
+        "-Wno-error=c23-extensions",
+    ],
     "//:fasttable_enabled_setting": ["-std=gnu99", "-DUPB_ENABLE_FASTTABLE"],
     "//conditions:default": [
         # copybara:strip_for_google3_begin
