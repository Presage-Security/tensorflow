Index: BUILD
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/BUILD b/BUILD
--- a/BUILD	(revision e4635f223e7d36dfbea3b722a4ca4807a7e882e2)
+++ b/BUILD	(date 1741618817311)
@@ -23,6 +23,7 @@
 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 # SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

+load("@bazel_skylib//lib:selects.bzl", "selects")
 load(
     "//bazel:build_defs.bzl",
     "UPB_DEFAULT_COPTS",
@@ -62,6 +63,33 @@
     visibility = ["//visibility:public"],
 )

+config_setting(
+    name = "darwin_legacy",
+    values = {"cpu": "darwin"},
+    visibility = ["//visibility:public"],
+)
+
+config_setting(
+    name = "darwin_x86_64",
+    values = {"cpu": "darwin_x86_64"},
+    visibility = ["//visibility:public"],
+)
+
+config_setting(
+    name = "darwin_arm64",
+    values = {"cpu": "darwin_arm64"},
+    visibility = ["//visibility:public"],
+)
+
+selects.config_setting_group(
+    name = "darwin",
+    match_any = [
+        ":darwin_legacy",
+        ":darwin_x86_64",
+        ":darwin_arm64",
+    ],
+)
+
 upb_fasttable_enabled(
     name = "fasttable_enabled",
     build_setting_default = False,
Index: bazel/build_defs.bzl
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/bazel/build_defs.bzl b/bazel/build_defs.bzl
--- a/bazel/build_defs.bzl	(revision e4635f223e7d36dfbea3b722a4ca4807a7e882e2)
+++ b/bazel/build_defs.bzl	(date 1741616459971)
@@ -57,6 +57,7 @@

 UPB_DEFAULT_COPTS = select({
     "//:windows": [],
+    "//:darwin": _DEFAULT_COPTS + ["-Wno-gnu-offsetof-extensions"],
     "//:fasttable_enabled_setting": ["-std=gnu99", "-DUPB_ENABLE_FASTTABLE"],
     "//conditions:default": _DEFAULT_COPTS,
 })
